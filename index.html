<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>مشتلة السلام — المتجر</title>

    <!-- مكتبات الخطوط والرموز -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">


<link rel="stylesheet" href="https://github.com/imadtbn/PlantShop-Essalam/blob/main/style.css">


 
</head>

<body>
    <!-- ======================
       الهيدر والتنقل
       ====================== -->
    <header>
        <div class="header-inner">
            <div class="brand" aria-label="مشتلة السلام">
                <i class="fas fa-seedling" style="font-size:26px;color:#fff"></i>
                <div>
                    <h1>مشتلة السلام</h1>
                    <p>أجود أنواع شتلات الأشجار والفواكه والخضروات</p>
                </div>
            </div>

            <nav aria-label="القائمة الرئيسية">
                <ul>
                    <li><a href="#fruit-trees">الأشجار المثمرة</a></li>
                    <li><a href="#flowers">الورود والزهور</a></li>
                    <li><a href="#ornamental">أشجار التزيين</a></li>
                    <li><a href="#vegetables">بذور وخضروات</a></li>
                    <li><a href="#tools">أدوات وأسمدة</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- قسم محرك البحث -->
    <div class="search-container">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="ابحث عن نباتات أو منتجات...">
            <button id="search-btn"><i class="fas fa-search"></i></button>
        </div>
    </div>

    <!-- ======================
       المحتوى: الأقسام والمنتجات (جميع الأصناف كما طلبت)
       الصور هنا من Unsplash لتحسين الجودة
       ====================== -->
    <main class="container">
        <!-- رسالة عدم وجود نتائج -->
        <div class="no-results" id="noResults">
            <i class="fas fa-search" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>لم يتم العثور على نتائج مطابقة للبحث</p>
        </div>

        <!-- قسم الأشجار المثمرة (يتضمن الزيتون بأصنافه) -->
        <section id="fruit-trees" class="category" aria-labelledby="h-fruit-trees">
            <div class="category-header">
                <h2 id="h-fruit-trees"><i class="fas fa-apple-whole" aria-hidden="true"></i> الأشجار المثمرة</h2>
            </div>

            <div class="products">
                <!-- المنتج 1: زيتون لإنتاج الزيت -->
                <div class="product" data-price="60" data-type="زيتون">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/zite.jpg"
                        alt="زيتون لإنتاج الزيت">
                    <div class="product-info">
                        <h3>زيتون لإنتاج الزيت</h3>
                        <p>صنف ممتاز لإنتاج الزيوت</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>شملال - 60 دج</li>
                                <li>سيقواز - 65 دج</li>
                                <li>بيكوال - 70 دج</li>
                                <li>ملكة العرب - 75 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('زيتون لإنتاج الزيت', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- المنتج 2: زيتون لإنتاج الزيت والترقيد -->
                <div class="product" data-price="55" data-type="زيتون">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/zitoun.jpg"
                        alt="زيتون للترقيد">
                    <div class="product-info">
                        <h3>زيتون لإنتاج الزيت والترقيد</h3>
                        <p>من أفضل الأصناف للترقيد</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>فركاني - 55 دج</li>
                                <li>بيكوال - 60 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('زيتون لإنتاج الزيت والترقيد', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- المنتج 3: زيتون للتخليل والترقيد -->
                <div class="product" data-price="65" data-type="زيتون">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/zmerager.jpg"
                        alt="زيتون للتخليل">
                    <div class="product-info">
                        <h3>زيتون للتخليل والترقيد</h3>
                        <p>صنف مميز لإنتاج الزيت والتخليل</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>فركاني - 65 دج</li>
                                <li>بيكوال - 70 دج</li>
                                <li>شملال - 75 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('زيتون للتخليل والترقيد', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- الحمضيات -->
                <div class="product" data-price="45" data-type="حمضيات">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/tchina.jpg"
                        alt="برتقال">
                    <div class="product-info">
                        <h3>برتقال</h3>
                        <p>صنف حلو المذاق وعالي الجودة</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>طومسون - 45 دج</li>
                                <li>بالنسي - 50 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('برتقال', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="50" data-type="حمضيات">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/limoun.jpg"
                        alt="ليمون">
                    <div class="product-info">
                        <h3>ليمون</h3>
                        <p>ليمون حمضي طازج وعالي الجودة</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>بنزهير - 50 دج</li>
                                <li>أربعة فصول - 55 دج</li>
                                <li>ليمون أصفر - 60 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('ليمون', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="55" data-type="حمضيات">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/mendarin.jpg"
                        alt="مندرين">
                    <div class="product-info">
                        <h3>مندرين</h3>
                        <p>فاكهة لذيذة سهلة التقشير</p>
                        <div class="varieties">
                            <strong>الأصناف المتاحة:</strong>
                            <ul>
                                <li>مندرين - 55 دج</li>
                                <li>كليمنتين - 60 دج</li>
                                <li>مندرين قزمية - 65 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('مندرين', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- فواكه بالنواة: خوخ، مشمش، برقوق، رمان -->
                <div class="product" data-price="65" data-type="فواكه بالنواة">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/khokh.jpg"
                        alt="خوخ">
                    <div class="product-info">
                        <h3>خوخ</h3>
                        <p>أشجار خوخ حلوة المذاق وعالية الإنتاج</p>
                        <div class="varieties">
                            <ul>
                                <li>خوخ مبكر - 65 دج</li>
                                <li>خوخ كعب الغزال - 70 دج</li>
                                <li>خوخ أبيض - 75 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('خوخ', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="70" data-type="فواكه بالنواة">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/mechmech.jpg"
                        alt="مشمش">
                    <div class="product-info">
                        <h3>مشمش</h3>
                        <p>أشجار مشمش عالية الجودة والإنتاج</p>
                        <div class="varieties">
                            <ul>
                                <li>مشمش حلواني - 70 دج</li>
                                <li>مشمش كانينو - 75 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('مشمش', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="70" data-type="فواكه بالنواة">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/bargog.jpg"
                        alt="برقوق">
                    <div class="product-info">
                        <h3>برقوق</h3>
                        <p>أشجار برقوق مثمرة وعالية الجودة</p>
                        <div class="varieties">
                            <ul>
                                <li>برقوق أصفر - 70 دج</li>
                                <li>برقوق أحمر - 75 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('برقوق', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="60" data-type="فواكه بالنواة">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/romman.jpg"
                        alt="رمان">
                    <div class="product-info">
                        <h3>رمان</h3>
                        <p>أشجار رمان عالية الجودة والإنتاج</p>
                        <div class="varieties">
                            <ul>
                                <li>رمان حلواني - 60 دج</li>
                                <li>رمان مانجولاتي - 65 دج</li>
                                <li>رمان بلدي - 70 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('رمان', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- كروم -->
                <div class="product" data-price="70" data-type="كروم">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/3ineb.jpg"
                        alt="عنب">
                    <div class="product-info">
                        <h3>عنب</h3>
                        <p>أصناف عنب ممتازة</p>
                        <div class="varieties">
                            <ul>
                                <li>عنب أحمر - 70 دج</li>
                                <li>عنب أبيض - 75 دج</li>
                                <li>عنب أسود - 80 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('عنب', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="65" data-type="كروم">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/tout.jpg"
                        alt="توت">
                    <div class="product-info">
                        <h3>توت</h3>
                        <p>أشجار توت مثمرة</p>
                        <div class="varieties">
                            <ul>
                                <li>توت أسود - 65 دج</li>
                                <li>توت أبيض - 70 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('توت', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="65" data-type="كروم">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/fig.jpg"
                        alt="تين">
                    <div class="product-info">
                        <h3>تين</h3>
                        <p>أشجار تين مثمرة</p>
                        <div class="varieties">
                            <ul>
                                <li>تين أسود - 65 دج</li>
                                <li>تين أبيض - 70 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('تين', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <!-- تفاحيات -->
                <div class="product" data-price="80" data-type="تفاح">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/teffah.jpg" alt="تفاح">
                    <div class="product-info">
                        <h3>تفاح</h3>
                        <p>أشجار تفاح عالية الجودة</p>
                        <div class="varieties">
                            <ul>
                                <li>أحمر – 80 دج</li>
                                <li>أصفر – 85 دج</li>
                                <li>أخضر – 90 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('تفاح', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="85" data-type="تفاح">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/endjaas.jpg" alt="إجاص">
                    <div class="product-info">
                        <h3>إجاص</h3>
                        <p>أشجار إجاص مثمرة عالية الجودة</p>
                        <div class="varieties">
                            <ul>
                                <li>أصفر – 85 دج</li>
                                <li>أخضر – 90 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('إجاص', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

            </div> <!-- نهاية المنتجات في قسم الأشجار المثمرة -->
        </section>

        <!-- قسم الورود والزهور -->
        <section id="flowers" class="category" aria-labelledby="h-flowers">
            <div class="category-header">
                <h2 id="h-flowers"><i class="fas fa-rose"></i> ورود، زهور ونباتات</h2>
            </div>

            <div class="products">
                <div class="product" data-price="40" data-type="ورود">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/w-djouri.jpg"
                        alt="ورد جوري">
                    <div class="product-info">
                        <h3>ورد جوري</h3>
                        <p>ملكة الزهور برائحتها العطرة</p>
                        <div class="varieties">
                            <ul>
                                <li>جوري أحمر - 40 دج</li>
                                <li>جوري وردي - 45 دج</li>
                                <li>جوري أبيض - 50 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('ورد جوري', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="35" data-type="ورود">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/w-feell.jpg"
                        alt="ورد فل">
                    <div class="product-info">
                        <h3>ورد فل</h3>
                        <p>رائحته فواحة وأزهاره بيضاء</p>
                        <div class="price">سعر الشتلة: 35 دج</div>
                        <button class="cart-btn" onclick="addToCart('ورد فل','','35')"><i class="fas fa-cart-plus"></i>
                            أضف للسلة</button>
                    </div>
                </div>

                <!-- يمكنك إضافة منتجات أخرى هنا بنفس البنية -->
            </div>

        </section>

        <!-- قسم التزيين والتسييج -->
        <section id="ornamental" class="category" aria-labelledby="h-ornamental">
            <div class="category-header">
                <h2 id="h-ornamental"><i class="fas fa-tree"></i> أشجار التزيين والتسييج</h2>
            </div>

            <div class="products">
                <div class="product" data-price="75" data-type="تزيين">
                    <img src="https://images.unsplash.com/photo-1603048719539-6d5a1d4a61e0?w=1200&q=60&auto=format&fit=crop"
                        alt="فيكس">
                    <div class="product-info">
                        <h3>فيكس</h3>
                        <p>شجرة زينة دائمة الخضرة</p>
                        <div class="varieties">
                            <ul>
                                <li>فيكس نتدا - 75 دج</li>
                                <li>فيكس بنجامينا - 80 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('فيكس', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="50" data-type="تسييج">
                    <img src="https://images.unsplash.com/photo-1597334948330-1d3c3ca0d0a8?w=1200&q=60&auto=format&fit=crop"
                        alt="تسييج">
                    <div class="product-info">
                        <h3>أشجار التسييج</h3>
                        <p>لتغطية الجدران والأسوار</p>
                        <div class="varieties">
                            <ul>
                                <li>صنوبر - 50 دج</li>
                                <li>كازارينا - 55 دج</li>
                                <li>صفصاف - 60 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('أشجار التسييج', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- بذور وشتلات -->
        <section id="vegetables" class="category" aria-labelledby="h-vegetables">
            <div class="category-header">
                <h2 id="h-vegetables"><i class="fas fa-seedling"></i> بذور وشتلات الخضروات</h2>
            </div>

            <div class="products">
                <div class="product" data-price="15" data-type="بذور">
                    <img src="https://images.unsplash.com/photo-1594282417921-2aabac452158?w=1200&q=60&auto=format&fit=crop"
                        alt="بذور طماطم">
                    <div class="product-info">
                        <h3>بذور طماطم</h3>
                        <p>بذور عالية الجودة</p>
                        <div class="varieties">
                            <ul>
                                <li>طماطم شيري - 15 دج</li>
                                <li>طماطم بلدي - 20 دج</li>
                                <li>طماطم هجين - 25 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('بذور طماطم', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="25" data-type="شتلات">
                    <img src="https://raw.githubusercontent.com/imadtbn/PlantShop-Essalam/refs/heads/main/images/chetlat.jpg"
                        alt="شتلات طماطم">
                    <div class="product-info">
                        <h3>شتلات طماطم</h3>
                        <p>شتلات جاهزة للزراعة</p>
                        <div class="price">سعر الشتلة: 25 دج</div>
                        <button class="cart-btn" onclick="addToCart('شتلات طماطم','','25')"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- أدوات وأسمدة -->
        <section id="tools" class="category" aria-labelledby="h-tools">
            <div class="category-header">
                <h2 id="h-tools"><i class="fas fa-wrench"></i> أدوات زراعية وأسمدة</h2>
            </div>

            <div class="products">
                <div class="product" data-price="30" data-type="أسمدة">
                    <img src="https://images.unsplash.com/photo-1550258987-190a2d41a8ba?w=1200&q=60&auto=format&fit=crop"
                        alt="أسمدة">
                    <div class="product-info">
                        <h3>أسمدة عضوية</h3>
                        <p>لتعزيز نمو النباتات</p>
                        <div class="varieties">
                            <ul>
                                <li>سماد دودي - 30 دج</li>
                                <li>كمبوست - 35 دج</li>
                                <li>سماد بلدي - 40 دج</li>
                            </ul>
                        </div>
                        
                        <button class="cart-btn" onclick="showVarietySelection('أسمدة عضوية', this)"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>

                <div class="product" data-price="120" data-type="أدوات">
                    <img src="https://images.unsplash.com/photo-1603048719539-6d5a1d4a61e0?w=1200&q=60&auto=format&fit=crop"
                        alt="أدوات">
                    <div class="product-info">
                        <h3>أدوات زراعية</h3>
                        <p>مجموعة متكاملة للعناية بالنباتات</p>
                        <div class="price">السعر: 120 دج للمجموعة</div>
                        <button class="cart-btn" onclick="addToCart('أدوات زراعية','','120')"><i
                                class="fas fa-cart-plus"></i> أضف للسلة</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- زر السلة العائم -->
    <button id="floatingCartBtn" aria-label="سلة المشتريات" title="عرض السلة">
        <i class="fas fa-shopping-cart" aria-hidden="true"></i>
        <span id="cartCount" class="count">0</span>
    </button>

    <!-- مودال الفاتورة + نموذج الزبون -->
    <div class="modal-backdrop" id="cartModal" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="invoiceTitle">
            <div class="modal-header">
                <h3 id="invoiceTitle">فاتورة المشتريات</h3>
                <div>
                    <button class="btn secondary" onclick="closeCartModal()" aria-label="إغلاق"><i
                            class="fas fa-times"></i> إغلاق</button>
                </div>
            </div>

            <div class="modal-body">
                <div id="invoiceContent">
                    <table class="invoice-table" id="invoiceTable" role="table" aria-label="قائمة المشتريات">
                        <thead>
                            <tr>
                                <th>الصنف</th>
                                <th>النوع/الصنف الفرعي</th>
                                <th>الكمية</th>
                                <th>سعر الوحدة</th>
                                <th>المجموع</th>
                                <th>إجراء</th>
                            </tr>
                        </thead>
                        <tbody id="invoiceRows">
                            <!-- يُملأ ديناميكياً -->
                        </tbody>
                    </table>

                    <div style="display:flex; justify-content:flex-end; gap:12px; margin-bottom:16px; flex-wrap:wrap;">
                        <div><strong>المجموع الفرعي:</strong> <span id="modalSubtotal">0 دج</span></div>
                        <div style="display:none;"><strong>تكلفة التوصيل:</strong> <span id="modalDelivery">0 دج</span>
                        </div>
                        <div><strong>المجموع الكلي:</strong> <span id="modalTotal">0 دج</span></div>
                    </div>

                    <h4 style="margin-top:6px; margin-bottom:8px;">معلومات الزبون</h4>
                    <div class="customer-grid">
                        <div class="form-group">
                            <label>الاسم الكامل</label>
                            <input id="custName" class="form-input" type="text" placeholder="الاسم الكامل" required>
                        </div>
                        <div class="form-group">
                            <label>رقم الهاتف</label>
                            <input id="custPhone" class="form-input" type="tel" placeholder="مثال: 0559123456" required>
                        </div>
                        <div class="form-group">
                            <label>الولاية</label>
                            <input id="custWilaya" class="form-input" type="text" placeholder="الولاية">
                        </div>
                        <div class="form-group">
                            <label>البلدية</label>
                            <input id="custMunicip" class="form-input" type="text" placeholder="البلدية">
                        </div>
                        <div class="form-group" style="grid-column:1 / -1;">
                            <label>عنوان التوصيل</label>
                            <textarea id="custAddress" class="form-input" rows="2"
                                placeholder="عنوان التوصيل"></textarea>
                        </div>
                        <div class="form-group" style="grid-column:1 / -1;">
                            <label>ملاحظات إضافية</label>
                            <textarea id="custNotes" class="form-input" rows="2" placeholder="ملاحظات"></textarea>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal-footer">
                <button class="btn secondary" onclick="clearCartConfirm()"><i class="fas fa-trash"></i> إفراغ
                    السلة</button>

                
                <button class="btn" id="sendOrderBtn" style="background:#1976d2;color:#fff;"
                    onclick="sendOrderToGoogleSheets()"><i class="fas fa-paper-plane"></i>تأكيد الشراء/إرسال طلبكم</button>
            </div>
        </div>
    </div>

    <!-- الفوتر -->
    <footer>
        <div class="footer-inner">
            <div class="footer-col">
                <h4>مشتلة السلام</h4>
                <p style="margin:6px 0 0 0; color:#dfeede;">أجود أنواع الشتلات والخدمات الزراعية — بيع وتوصيل واستشارات
                    زراعية.</p>
            </div>

            <div class="footer-col">
                <h4>اتصل بنا</h4>
                <div class="footer-links">
                    <a href="tel:0559219855"><i class="fas fa-phone"></i> 0559 219 855</a>
                    <a href="tel:0799686060"><i class="fas fa-phone"></i> 0799 686 060</a>
                    <a href="mailto:info@nabatati.com"><i class="fas fa-envelope"></i> info@nabatati.com</a>
                </div>
            </div>

            <div class="footer-col">
                <h4>موقعنا</h4>
                <p style="margin:6px 0 0 0;"><i class="fas fa-map-marker-alt"></i> الطريق الوطني رقم 24، سيباو - بغلية،
                    ولاية بومرداس</p>
                <a href="https://maps.app.goo.gl/vwdRQ8Jun1TDyk627" target="_blank"
                    style="color:#d7f0d7; display:inline-block; margin-top:8px;"><i class="fas fa-map-marked-alt"></i>
                    التوجّه إلى المشتلة</a>
            </div>
        </div>

        <div class="footer-bottom">جميع الحقوق محفوظة &copy; <span id="year"></span> مشتلة السلام</div>
    </footer>

    <!-- ======================
       JavaScript: منطق السلة، الفاتورة، الإرسال
       ====================== -->
    <script>
        /*****************************************************************
         * إعدادات مهمة:
         *****************************************************************/
        const GOOGLE_SHEETS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzwgDo7n6mTLcovr9o093M_T4G0IQlXfRAatfk14HnZQThPjKdCtygbLkeuNOgK9ka6YA/exec';
        const ENABLE_PERSIST_CART = true; 

        let cart = [];

        // عناصر DOM
        const floatingCartBtn = document.getElementById('floatingCartBtn');
        const cartCount = document.getElementById('cartCount');
        const cartModal = document.getElementById('cartModal');
        const invoiceRows = document.getElementById('invoiceRows');
        const modalSubtotal = document.getElementById('modalSubtotal');
        const modalTotal = document.getElementById('modalTotal');
        const yearEl = document.getElementById('year');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const noResults = document.getElementById('noResults');

        yearEl.textContent = new Date().getFullYear();

        // تحميل السلة من التخزين المحلي
        window.addEventListener('DOMContentLoaded', () => {
            if (ENABLE_PERSIST_CART) {
                try {
                    const saved = localStorage.getItem('nabatati_cart_v2');
                    if (saved) cart = JSON.parse(saved) || [];
                } catch (e) { cart = []; }
            }
            updateCartCount();
        });

        // فتح/إغلاق المودال
        function openCartModal() {
            updateInvoice();
            cartModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        function closeCartModal() {
            cartModal.style.display = 'none';
            document.body.style.overflow = '';
        }
        floatingCartBtn.addEventListener('click', () => {
            updateInvoice();
            openCartModal();
        });

        // إضافة للسلة
        function addToCart(productName, variety = '', price = 0, qty = 1) {
            const idx = cart.findIndex(i => i.productName === productName && i.variety === variety);
            if (idx > -1) cart[idx].quantity += qty;
            else cart.push({ productName, variety, price, quantity: qty });
            persistCart();
            updateCartCount();
        }

        // حذف من السلة
        function removeFromCart(index) {
            if (index >= 0 && index < cart.length) {
                if (confirm('هل تريد حذف هذا المنتج؟')) {
                    cart.splice(index, 1);
                    persistCart();
                    updateCartCount();
                    updateInvoice();
                }
            }
        }

        // تغيير الكمية
        function changeQty(index, value) {
            const v = parseInt(value) || 1;
            if (v > 0 && index >= 0 && index < cart.length) {
                cart[index].quantity = v;
                persistCart();
                updateCartCount();
                updateInvoice();
            }
        }

        // تحديث الجدول
        function updateInvoice() {
            invoiceRows.innerHTML = '';
            if (cart.length === 0) {
                invoiceRows.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:18px; color:#777;">السلة فارغة</td></tr>`;
                modalSubtotal.textContent = modalTotal.textContent = '0 دج';
                return;
            }
            let subtotal = 0;
            cart.forEach((item, idx) => {
                const unitPrice = parseFloat(item.price) || 0;
                const qty = parseInt(item.quantity) || 1;
                const total = unitPrice * qty;
                subtotal += total;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${escapeHtml(item.productName)}</td>
                    <td>${escapeHtml(item.variety || '-')}</td>
                    <td><input type="number" min="1" value="${qty}" onchange="changeQty(${idx}, this.value)" style="width:70px;"></td>
                    <td>${formatNumber(unitPrice)} دج</td>
                    <td>${formatNumber(total)} دج</td>
                    <td><button onclick="removeFromCart(${idx})"><i class="fas fa-trash"></i></button></td>
                `;
                invoiceRows.appendChild(tr);
            });
            modalSubtotal.textContent = `${formatNumber(subtotal)} دج`;
            modalTotal.textContent = `${formatNumber(subtotal)} دج`;
        }

        // تحديث العداد
        function updateCartCount() {
            const total = cart.reduce((s, i) => s + (parseInt(i.quantity) || 1), 0);
            cartCount.textContent = total;
        }

        // حفظ السلة
        function persistCart() {
            if (ENABLE_PERSIST_CART) {
                try { localStorage.setItem('nabatati_cart_v2', JSON.stringify(cart)); } catch (e) {}
            }
        }

        // جمع بيانات الطلب
        function collectOrderData() {
            const items = cart.map(i => ({
                product: i.productName,
                variety: i.variety || '',
                qty: i.quantity || 1,
                unitPrice: i.price || 0,
                total: (parseFloat(i.price) || 0) * (parseInt(i.quantity) || 1)
            }));
            const subtotal = items.reduce((s, it) => s + (it.total || 0), 0);
            const customer = {
                name: document.getElementById('custName').value.trim(),
                phone: document.getElementById('custPhone').value.trim(),
                wilaya: document.getElementById('custWilaya').value.trim(),
                municipality: document.getElementById('custMunicip').value.trim(),
                address: document.getElementById('custAddress').value.trim(),
                notes: document.getElementById('custNotes').value.trim()
            };
            return { items, subtotal, customer };
        }

        // إرسال الطلب إلى Google Sheets
        function sendOrderToGoogleSheets() {
            const order = collectOrderData();
            
            // التحقق من البيانات المطلوبة
            if (!order.customer.name || !order.customer.phone) {
                alert('الرجاء إدخال الاسم الكامل ورقم الهاتف');
                return;
            }
            
            if (order.items.length === 0) {
                alert('السلة فارغة، الرجاء إضافة منتجات أولاً');
                return;
            }

            const btn = document.getElementById('sendOrderBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';

            fetch(GOOGLE_SHEETS_WEBAPP_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(order)
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                alert('تم إرسال طلبك بنجاح! سنتصل بك قريباً لتأكيد الطلب.');
                cart = [];
                persistCart();
                updateCartCount();
                closeCartModal();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء إرسال الطلب. الرجاء المحاولة مرة أخرى.');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // تأكيد إفراغ السلة
        function clearCartConfirm() {
            if (cart.length === 0) return;
            if (confirm('هل أنت متأكد من إفراغ السلة بالكامل؟')) {
                cart = [];
                persistCart();
                updateCartCount();
                updateInvoice();
            }
        }

        // عرض اختيار الأصناف
        function showVarietySelection(productName, btnElement) {
            const productCard = btnElement.closest('.product');
            const varieties = productCard.querySelectorAll('.varieties li');
            
            if (varieties.length === 0) {
                const price = productCard.dataset.price || '0';
                addToCart(productName, '', price);
                return;
            }
            
            let options = '';
            varieties.forEach(li => {
                const text = li.textContent.trim();
                const priceMatch = text.match(/(\d+)\s*دج/);
                const price = priceMatch ? priceMatch[1] : '0';
                const variety = text.replace(/\s*-\s*\d+\s*دج/, '').trim();
                options += `<option value="${price}|${variety}">${text}</option>`;
            });
            
            const selected = prompt(`اختر صنف من ${productName}:\n\n${Array.from(varieties).map(li => li.textContent).join('\n')}`);
            if (selected) {
                const selectedOption = Array.from(varieties).find(li => li.textContent.includes(selected));
                if (selectedOption) {
                    const text = selectedOption.textContent.trim();
                    const priceMatch = text.match(/(\d+)\s*دج/);
                    const price = priceMatch ? priceMatch[1] : '0';
                    const variety = text.replace(/\s*-\s*\d+\s*دج/, '').trim();
                    addToCart(productName, variety, price);
                }
            }
        }

        // وظائف مساعدة
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatNumber(num) {
            return parseFloat(num).toLocaleString('ar-EG');
        }

        // وظيفة البحث المحسنة
        function performSearch() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            const products = document.querySelectorAll('.product');
            let hasResults = false;
            
            if (searchTerm === '') {
                // إظهار جميع المنتجات عند حذف نص البحث
                products.forEach(product => {
                    product.style.display = 'flex';
                    product.closest('.category').style.display = 'block';
                });
                noResults.style.display = 'none';
                return;
            }
            
            products.forEach(product => {
                const productName = product.querySelector('h3').textContent.toLowerCase();
                const productDesc = product.querySelector('p').textContent.toLowerCase();
                const productType = product.dataset.type.toLowerCase();
                
                if (productName.includes(searchTerm) {
                    product.style.display = 'flex';
                    product.closest('.category').style.display = 'block';
                    hasResults = true;
                } else if (productDesc.includes(searchTerm) {
                    product.style.display = 'flex';
                    product.closest('.category').style.display = 'block';
                    hasResults = true;
                } else if (productType.includes(searchTerm)) {
                    product.style.display = 'flex';
                    product.closest('.category').style.display = 'block';
                    hasResults = true;
                } else {
                    product.style.display = 'none';
                }
            });
            
            // التحقق مما إذا كان هناك نتائج
            const visibleCategories = document.querySelectorAll('.category:not([style*="display: none"])');
            visibleCategories.forEach(category => {
                const visibleProducts = category.querySelectorAll('.product:not([style*="display: none"])');
                if (visibleProducts.length === 0) {
                    category.style.display = 'none';
                }
            });
            
            noResults.style.display = hasResults ? 'none' : 'block';
        }

        // أحداث البحث
        searchBtn.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</body>
</html>